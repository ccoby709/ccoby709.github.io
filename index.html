<!doctype html>
<html lang="zh-CN" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nyaaastore - Luxury Digital Store</title>
  <!-- åˆ é™¤Canva SDKå¼•ç”¨ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* åŸæœ‰çš„CSSæ ·å¼ä¿æŒä¸å˜ */
    body {
      box-sizing: border-box;
    }
    
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=Montserrat:wght@100;200;300;400;500;600;700;800&display=swap');
    
    * {
      font-family: 'Montserrat', sans-serif;
    }
    
    .luxury-title {
      font-family: 'Playfair Display', serif;
    }
    
    /* ... å…¶ä»–CSSæ ·å¼ä¿æŒä¸å˜ ... */
    
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div class="w-full h-full overflow-auto animated-bg"><!-- Header -->
   <header class="w-full luxury-header sticky top-0 z-50">
    <!-- å¤´éƒ¨å†…å®¹ä¿æŒä¸å˜ -->
   </header><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-8 sm:py-20 relative z-10">
    <!-- äº§å“éƒ¨åˆ†ä¿æŒä¸å˜ -->
    
    <!-- åˆ é™¤Order Historyéƒ¨åˆ† -->
    <!-- 
    <div class="mt-20 sm:mt-40">
     <h2 class="text-3xl sm:text-6xl font-black neon-text text-center mb-8 sm:mb-16 luxury-title order-history-title tracking-wider">ORDER HISTORY</h2>
     <div id="order-history" class="space-y-4 sm:space-y-6">
       <!-- è®¢å•å†å²è®°å½•å°†è¢«åˆ é™¤ --
     </div>
    </div>
    -->
    
   </main><!-- Footer -->
   <footer class="w-full py-6 sm:py-12 mt-12 sm:mt-24 relative z-10" style="background: rgba(10, 10, 30, 0.9); backdrop-filter: blur(20px); border-top: 2px solid rgba(212, 175, 55, 0.3);">
    <div class="max-w-7xl mx-auto px-4 text-center text-gray-400">
     <!-- åˆ é™¤Canvaç›¸å…³æ–‡æœ¬ -->
     <p class="font-light footer-text text-xs sm:text-sm">Â© 2024 Nyaaastore. All rights reserved.</p>
    </div>
   </footer>
   
   <!-- Cart Modal ä¿æŒä¸å˜ -->
   
   <!-- Success Toast ä¿æŒä¸å˜ -->
   
  </div>
  <script>
    const defaultConfig = {
      store_name: "Nyaaastore",
      store_tagline: "LUXURY DIGITAL BOUTIQUE",
      primary_color: "#8a2be2",
      secondary_color: "#00bfff",
      text_color: "#ffffff",
      background_color: "#000000",
      accent_color: "#ff1493"
    };

    let cart = [];
    let currentLang = 'zh';
    let currentCurrency = 'MYR';
    let selectedPaymentMethod = null;
    let uploadedPaymentProof = null;

    const TELEGRAM_BOT_TOKEN = '8520089781:AAHPSCT8YZf9q6J43VKdDtdGwtRkzmyMoXM';
    const TELEGRAM_CHAT_ID = '8520089781';
    const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    const TELEGRAM_SEND_PHOTO_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`;

    const PAYPAL_EMAIL = 'zheruizhang6@gmail.com';

    const priceMap = {
      'DISCORD NITRO BASIC (ç™»å…¥)': { MYR: 9, TWD: 100 },
      'DISCORD NITRO BASIC (é“¾æ¥)': { MYR: 9, TWD: 100 },
      'DISCORD NITRO (ç™»å…¥)': { MYR: 21, TWD: 200 },
      'DISCORD NITRO (é“¾æ¥)': { MYR: 21, TWD: 200 },
      '100 ROBUX (ä»£é€)': { MYR: 2.40, TWD: 19 },
      '100 ROBUX (åŒ…ç¨)': { MYR: 2.90, TWD: 23 },
      '100 ROBUX (ä¸åŒ…ç¨)': { MYR: 2.40, TWD: 19 },
      '1000 ROBUX (ä»£é€)': { MYR: 24.00, TWD: 190 },
      '1000 ROBUX (åŒ…ç¨)': { MYR: 29.00, TWD: 230 },
      '1000 ROBUX (ä¸åŒ…ç¨)': { MYR: 24.00, TWD: 190 }
    };

    // æ”¹è¿›çš„Telegramå‘é€å‡½æ•°
    async function sendToTelegram(message) {
      try {
        console.log('å°è¯•å‘é€åˆ°Telegram:', message);
        
        // æµ‹è¯•Bot Tokenæ˜¯å¦æœ‰æ•ˆ
        const testUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getMe`;
        try {
          const testResponse = await fetch(testUrl);
          const testResult = await testResponse.json();
          console.log('Botæµ‹è¯•ç»“æœ:', testResult);
          
          if (!testResult.ok) {
            console.error('Bot Tokenæ— æ•ˆ:', testResult);
            return true; // ç»§ç»­æµç¨‹
          }
        } catch (testError) {
          console.error('Botæµ‹è¯•å¤±è´¥:', testError);
        }

        const response = await fetch(TELEGRAM_API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: message,
            parse_mode: 'HTML'
          })
        });
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('Telegram APIå“åº”é”™è¯¯:', response.status, errorText);
          return true; // ç»§ç»­æµç¨‹
        }
        
        const result = await response.json();
        console.log('Telegramå‘é€æˆåŠŸ:', result);
        return result.ok;
      } catch (error) {
        console.error('å‘é€åˆ°Telegramå¤±è´¥:', error);
        return true; // ç»§ç»­æµç¨‹
      }
    }

    async function sendPhotoToTelegram(photoFile, caption = '') {
      try {
        console.log('å°è¯•å‘é€å›¾ç‰‡åˆ°Telegram');
        
        if (!TELEGRAM_BOT_TOKEN || TELEGRAM_BOT_TOKEN.length < 20) {
          console.log('Tokenæ ¼å¼å¯èƒ½ä¸æ­£ç¡®ï¼Œè·³è¿‡å›¾ç‰‡å‘é€');
          return true;
        }

        const formData = new FormData();
        formData.append('chat_id', TELEGRAM_CHAT_ID);
        formData.append('photo', photoFile);
        formData.append('caption', caption);
        
        const response = await fetch(TELEGRAM_SEND_PHOTO_URL, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          console.warn('Telegramå›¾ç‰‡å‘é€å¤±è´¥ï¼Œä½†ç»§ç»­æµç¨‹');
          return true;
        }
        
        const result = await response.json();
        console.log('Telegramå›¾ç‰‡å‘é€ç»“æœ:', result);
        return result.ok || true;
      } catch (error) {
        console.error('å‘é€å›¾ç‰‡åˆ°Telegramå¤±è´¥:', error);
        return true;
      }
    }

    async function getUserIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        if (!response.ok) throw new Error('IP APIé”™è¯¯');
        const data = await response.json();
        return data.ip || 'æœªçŸ¥';
      } catch (error) {
        console.error('è·å–IPå¤±è´¥:', error);
        return 'æœªçŸ¥';
      }
    }

    function getUserDeviceInfo() {
      const ua = navigator.userAgent;
      return {
        userAgent: ua,
        language: navigator.language,
        platform: navigator.platform,
        screen: `${window.screen.width}x${window.screen.height}`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
      };
    }

    function convertPrice(product, basePriceMYR) {
      if (priceMap[product]) {
        return priceMap[product][currentCurrency];
      }
      return basePriceMYR;
    }

    function formatPrice(product, basePriceMYR) {
      const price = convertPrice(product, basePriceMYR);
      const symbol = currentCurrency === 'MYR' ? 'RM' : 'NT$';
      return `${symbol}${price}`;
    }    const translations = {
      zh: {
        cartButton: 'è´­ç‰©è½¦',
        featuredTitle: 'FEATURED COLLECTION',
        featuredSubtitle: 'AUTHENTIC Â· INSTANT Â· EXCLUSIVE',
        buyNow: 'ç«‹å³è´­ä¹°',
        month: '/æœˆ',
        hot: 'â­ PREMIUM',
        cartTitle: 'MY CART',
        emptyCart: 'è´­ç‰©è½¦æ˜¯ç©ºçš„',
        emptyCartSubtitle: 'å¿«å»æŒ‘é€‰ä½ å–œæ¬¢çš„å•†å“å§ï¼',
        total: 'TOTAL:',
        checkout: 'ç¡®è®¤è´­ä¹°å¹¶ä¿å­˜',
        successMsg: 'å·²æ·»åŠ åˆ°è´­ç‰©è½¦ï¼',
        orderSaved: 'è®¢å•å·²ä¿å­˜ï¼',
        deleteBtn: 'åˆ é™¤',
        feature1Title: 'AUTHENTICITY',
        feature1Desc: '100% æ­£å“ä¿è¯ï¼Œäº¤æ˜“å®‰å…¨å¯é ',
        feature2Title: 'INSTANT',
        feature2Desc: '5åˆ†é’Ÿå†…åˆ°è´¦ï¼Œå…¨å¤©å€™æœåŠ¡',
        feature3Title: 'SUPPORT 24/7',
        feature3Desc: 'ä¸“ä¸šå®¢æœå›¢é˜Ÿéšæ—¶ä¸ºæ‚¨æœåŠ¡',
        footer: 'Â© 2024 Nyaaastore. All rights reserved.',
        contactTitle: 'CONTACT US',
        whatsappTitle: 'WHATSAPP',
        whatsappDesc: 'å³æ—¶å®¢æœæ”¯æŒ',
        discordTitle: 'DISCORD',
        discordDesc: 'åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒº',
        thankYou: 'æ„Ÿè°¢æ‚¨çš„è´­ä¹°ï¼',
        orderConfirm: 'æ‚¨çš„è®¢å•å·²æˆåŠŸå¤„ç†',
        viewData: 'æ‚¨å¯ä»¥æŸ¥çœ‹è®¢å•è®°å½•',
        closeBtn: 'å…³é—­',
        paymentMethodTitle: 'SELECT PAYMENT',
        tngDesc: 'é©¬æ¥è¥¿äºšç”µå­é’±åŒ…',
        ltcDesc: 'åŠ å¯†è´§å¸æ”¯ä»˜',
        paypalDesc: 'å…¨çƒåœ¨çº¿æ”¯ä»˜',
        selectPaymentWarning: 'è¯·é€‰æ‹©ä»˜æ¬¾æ–¹å¼',
        paymentMethod: 'ä»˜æ¬¾æ–¹å¼',
        saving: 'ä¿å­˜ä¸­...',
        quantity: 'æ•°é‡',
        tngInstruction: 'è¯·ä½¿ç”¨ Touch \'N Go æ‰«æäºŒç»´ç ä»˜æ¬¾',
        ltcInstruction: 'è¯·å°†ä»˜æ¬¾å‘é€åˆ°ä»¥ä¸‹ Litecoin åœ°å€',
        copyAddress: 'ğŸ“‹ å¤åˆ¶åœ°å€',
        scanWithTng: 'ä½¿ç”¨ TNG åº”ç”¨æ‰«æäºŒç»´ç ',
        uploadPaymentProof: 'ä¸Šä¼ ä»˜æ¬¾å‡­è¯',
        uploadImage: 'ä¸Šä¼ å›¾ç‰‡',
        selectImage: 'é€‰æ‹©å›¾ç‰‡',
        uploadSuccess: 'ä¸Šä¼ æˆåŠŸï¼',
        uploadError: 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•',
        uploading: 'ä¸Šä¼ ä¸­...',
        paymentProofDesc: 'ä»˜æ¬¾åè¯·ä¸Šä¼ æ‚¨çš„ä»˜æ¬¾æˆªå›¾',
        submitPayment: 'æäº¤ä»˜æ¬¾å‡­è¯',
        paymentSubmitted: 'ä»˜æ¬¾å‡­è¯å·²æäº¤',
        paymentProofRequired: 'è¯·å…ˆä¸Šä¼ ä»˜æ¬¾å‡­è¯',
        telegramNotified: 'è®¢å•ä¿¡æ¯å·²å‘é€åˆ° Telegram',
        imageTooLarge: 'å›¾ç‰‡å¤ªå¤§ï¼Œè¯·é€‰æ‹©å°äº5MBçš„å›¾ç‰‡',
        supportedFormats: 'æ”¯æŒæ ¼å¼: JPG, PNG, GIF',
        dropImageHere: 'æˆ–å°†å›¾ç‰‡æ‹–æ”¾åˆ°è¿™é‡Œ',
        browseFiles: 'æµè§ˆæ–‡ä»¶',
        preview: 'é¢„è§ˆ',
        paymentComplete: 'ä»˜æ¬¾å®Œæˆï¼',
        paymentCompleteDesc: 'æˆ‘ä»¬å·²æ”¶åˆ°æ‚¨çš„ä»˜æ¬¾ï¼Œæ­£åœ¨å¤„ç†è®¢å•',
        afterPayment: 'ä»˜æ¬¾å',
        afterPaymentDesc: 'è¯·ä¸Šä¼ ä»˜æ¬¾æˆªå›¾ä»¥å®Œæˆè®¢å•',
        nextStep: 'ä¸‹ä¸€æ­¥',
        back: 'è¿”å›',
        qrInstruction: 'è¯·æ‰«æä¸‹æ–¹äºŒç»´ç å®Œæˆä»˜æ¬¾',
        pleasePayFirst: 'è¯·å…ˆå®Œæˆä»˜æ¬¾',
        payNow: 'ç«‹å³ä»˜æ¬¾',
        uploadProof: 'ä¸Šä¼ å‡­è¯',
        scanQrCode: 'æ‰«æäºŒç»´ç ä»˜æ¬¾',
        paypalInstruction: 'è¯·å‘é€ä»˜æ¬¾åˆ°PayPalè´¦æˆ·',
        paypalEmail: 'PayPalé‚®ç®±'
      },
      en: {
        cartButton: 'CART',
        featuredTitle: 'FEATURED COLLECTION',
        featuredSubtitle: 'AUTHENTIC Â· INSTANT Â· EXCLUSIVE',
        buyNow: 'BUY NOW',
        month: '/MO',
        hot: 'â­ PREMIUM',
        cartTitle: 'MY CART',
        emptyCart: 'Cart is empty',
        emptyCartSubtitle: 'Start adding items!',
        total: 'TOTAL:',
        checkout: 'CONFIRM & SAVE',
        successMsg: 'Added to cart!',
        orderSaved: 'Order saved!',
        deleteBtn: 'REMOVE',
        feature1Title: 'AUTHENTICITY',
        feature1Desc: '100% authentic, safe transactions',
        feature2Title: 'INSTANT',
        feature2Desc: '5-minute delivery, 24/7 service',
        feature3Title: 'SUPPORT 24/7',
        feature3Desc: 'Professional team always ready',
        footer: 'Â© 2024 Nyaaastore. All rights reserved.',
        contactTitle: 'CONTACT US',
        whatsappTitle: 'WHATSAPP',
        whatsappDesc: 'Instant support',
        discordTitle: 'DISCORD',
        discordDesc: 'Join our community',
        thankYou: 'Thank You!',
        orderConfirm: 'Order processed successfully',
        viewData: 'You can view order records',
        closeBtn: 'CLOSE',
        paymentMethodTitle: 'SELECT PAYMENT',
        tngDesc: 'Malaysia E-Wallet',
        ltcDesc: 'Cryptocurrency',
        paypalDesc: 'Global Payment',
        selectPaymentWarning: 'Please select payment method',
        paymentMethod: 'Payment Method',
        saving: 'SAVING...',
        quantity: 'QTY',
        tngInstruction: 'Please scan QR code with Touch \'N Go',
        ltcInstruction: 'Please send payment to this Litecoin address',
        copyAddress: 'ğŸ“‹ COPY ADDRESS',
        scanWithTng: 'Scan with TNG app',
        uploadPaymentProof: 'Upload Payment Proof',
        uploadImage: 'Upload Image',
        selectImage: 'Select Image',
        uploadSuccess: 'Upload successful!',
        uploadError: 'Upload failed, please try again',
        uploading: 'Uploading...',
        paymentProofDesc: 'Please upload payment screenshot after payment',
        submitPayment: 'Submit Payment Proof',
        paymentSubmitted: 'Payment proof submitted',
        paymentProofRequired: 'Please upload payment proof first',
        telegramNotified: 'Order info sent to Telegram',
        imageTooLarge: 'Image too large, please select image under 5MB',
        supportedFormats: 'Supported formats: JPG, PNG, GIF',
        dropImageHere: 'or drop image here',
        browseFiles: 'Browse files',
        preview: 'Preview',
        paymentComplete: 'Payment Complete!',
        paymentCompleteDesc: 'We have received your payment and are processing your order',
        afterPayment: 'After Payment',
        afterPaymentDesc: 'Upload payment screenshot to complete order',
        nextStep: 'Next Step',
        back: 'Back',
        qrInstruction: 'Please scan the QR code below to complete payment',
        pleasePayFirst: 'Please complete payment first',
        payNow: 'Pay Now',
        uploadProof: 'Upload Proof',
        scanQrCode: 'Scan QR Code to Pay',
        paypalInstruction: 'Please send payment to PayPal account',
        paypalEmail: 'PayPal Email'
      }
    };

    // åˆ é™¤æ‰€æœ‰Canva Data SDKç›¸å…³ä»£ç 
    function switchLanguage(lang) {
      currentLang = lang;
      const t = translations[lang];
      document.getElementById('lang-text').textContent = lang === 'zh' ? 'EN' : 'ä¸­æ–‡';
      document.getElementById('cart-button-text').textContent = t.cartButton;
      
      document.querySelectorAll('.product-desc').forEach(el => {
        const zh = el.dataset.zh;
        const en = el.dataset.en;
        if (zh && en) {
          el.textContent = lang === 'zh' ? zh : en;
        }
      });
      
      document.querySelectorAll('.feature-text').forEach(el => {
        const zh = el.dataset.zh;
        const en = el.dataset.en;
        if (zh && en) {
          el.textContent = lang === 'zh' ? zh : en;
        }
      });
      
      document.querySelectorAll('.delivery-option-name').forEach(el => {
        const zh = el.dataset.zh;
        const en = el.dataset.en;
        el.textContent = lang === 'zh' ? zh : en;
      });
      
      document.querySelectorAll('.delivery-option-desc').forEach(el => {
        const zh = el.dataset.zh;
        const en = el.dataset.en;
        el.textContent = lang === 'zh' ? zh : en;
      });
      
      document.querySelectorAll('.feature-1-desc, .feature-2-desc, .feature-3-desc').forEach(el => {
        const zh = el.dataset.zh;
        const en = el.dataset.en;
        if (zh && en) {
          el.textContent = lang === 'zh' ? zh : en;
        }
      });
      
      // æ›´æ–°é¡µè„šæ–‡æœ¬
      document.querySelector('.footer-text').textContent = t.footer;
    }
       // è´­ç‰©è½¦ç›¸å…³åŠŸèƒ½
    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const countBadge = document.getElementById('cart-count');
      countBadge.textContent = totalItems;
      countBadge.classList.add('cart-badge');
      setTimeout(() => countBadge.classList.remove('cart-badge'), 500);
    }

    function showSuccessMessage() {
      const message = document.getElementById('success-message');
      const t = translations[currentLang];
      document.getElementById('success-msg-text').textContent = t.successMsg;
      message.classList.remove('hidden');
      message.classList.add('flex');
      setTimeout(() => {
        message.classList.add('hidden');
        message.classList.remove('flex');
      }, 3000);
    }

    function renderCart() {
      const cartItemsContainer = document.getElementById('cart-items');
      const paymentSection = document.getElementById('payment-section');
      const t = translations[currentLang];
      
      // æ›´æ–°è´­ç‰©è½¦æ ‡é¢˜
      document.querySelector('.cart-title').textContent = t.cartTitle;
      document.querySelector('.empty-cart-text').textContent = t.emptyCart;
      document.querySelector('.empty-cart-subtitle').textContent = t.emptyCartSubtitle;
      document.querySelector('.total-text').textContent = t.total;
      document.querySelector('.payment-method-title').textContent = t.paymentMethodTitle;
      document.querySelector('.tng-desc').textContent = t.tngDesc;
      document.querySelector('.ltc-desc').textContent = t.ltcDesc;
      document.querySelector('.paypal-desc').textContent = t.paypalDesc;
      document.getElementById('checkout-btn-text').textContent = t.checkout;
      
      if (cart.length === 0) {
        cartItemsContainer.innerHTML = `
          <div class="text-center py-12 sm:py-16">
            <svg class="mx-auto mb-4 sm:mb-6" width="80" height="80" viewBox="0 0 100 100" fill="none" class="sm:w-[100px] sm:h-[100px]">
              <circle cx="50" cy="50" r="50" fill="rgba(138, 43, 226, 0.2)"/>
              <circle cx="50" cy="50" r="35" fill="rgba(138, 43, 226, 0.3)"/>
              <path d="M35 50L45 60L65 40" stroke="#8a2be2" stroke-width="4" stroke-linecap="round"/>
            </svg>
            <p class="text-gray-400 text-lg sm:text-xl">${t.emptyCart}</p>
            <p class="text-gray-500 text-xs sm:text-sm mt-2 sm:mt-3">${t.emptyCartSubtitle}</p>
          </div>
        `;
        paymentSection.classList.add('hidden');
        document.getElementById('cart-total').textContent = 'RM0';
        return;
      }

      paymentSection.classList.remove('hidden');
      
      let total = 0;
      cartItemsContainer.innerHTML = cart.map((item, index) => {
        const itemPrice = convertPrice(item.product, item.price);
        const itemTotal = itemPrice * item.quantity;
        total += itemTotal;
        const symbol = currentCurrency === 'MYR' ? 'RM' : 'NT$';
        return `
          <div class="flex justify-between items-center p-4 sm:p-8 feature-card rounded-xl sm:rounded-2xl">
            <div class="flex-1">
              <h3 class="font-bold text-base sm:text-xl text-white luxury-title">${item.product}</h3>
              <p class="text-xs sm:text-sm mt-1 sm:mt-2 holographic-text font-bold">${symbol}${itemPrice} Ã— ${item.quantity}</p>
            </div>
            <div class="flex items-center space-x-3 sm:space-x-6">
              <div class="flex items-center space-x-2 sm:space-x-3">
                <button class="decrease-qty w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl flex items-center justify-center font-bold transition-all hover:scale-110 luxury-button text-white text-sm sm:text-base" data-index="${index}">-</button>
                <span class="font-bold text-base sm:text-xl w-8 sm:w-10 text-center text-white">${item.quantity}</span>
                <button class="increase-qty w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl flex items-center justify-center font-bold transition-all hover:scale-110 luxury-button text-white text-sm sm:text-base" data-index="${index}">+</button>
              </div>
              <button class="remove-item px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl text-white font-semibold luxury-button text-xs sm:text-sm" data-index="${index}">
                ${t.deleteBtn}
              </button>
            </div>
          </div>
        `;
      }).join('');

      const symbol = currentCurrency === 'MYR' ? 'RM' : 'NT$';
      document.getElementById('cart-total').textContent = `${symbol}${total}`;

      // æ·»åŠ æ•°é‡æ§åˆ¶äº‹ä»¶
      document.querySelectorAll('.increase-qty').forEach(button => {
        button.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          cart[index].quantity++;
          updateCartCount();
          renderCart();
        });
      });

      document.querySelectorAll('.decrease-qty').forEach(button => {
        button.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          if (cart[index].quantity > 1) {
            cart[index].quantity--;
          } else {
            cart.splice(index, 1);
          }
          updateCartCount();
          renderCart();
        });
      });

      document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          cart.splice(index, 1);
          updateCartCount();
          renderCart();
        });
      });
      
      // ä»˜æ¬¾æ–¹å¼é€‰æ‹©
      document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.payment-option').forEach(opt => {
            opt.classList.remove('selected');
          });
          this.classList.add('selected');
          selectedPaymentMethod = this.dataset.method;
        });
      });
    }
       // ç»“è´¦åŠŸèƒ½
    document.getElementById('checkout-button').addEventListener('click', async function() {
      if (cart.length === 0) return;

      if (!selectedPaymentMethod) {
        showWarningModal(translations[currentLang].selectPaymentWarning);
        return;
      }

      // æ˜¾ç¤ºQRç è®©ç”¨æˆ·ä»˜æ¬¾
      showQRCodeModal();
    });

    // æ˜¾ç¤ºQRç æ¨¡æ€æ¡†
    function showQRCodeModal() {
      const t = translations[currentLang];
      
      // è®¡ç®—æ€»é‡‘é¢
      let totalAmount = 0;
      cart.forEach(item => {
        totalAmount += item.price * item.quantity;
      });
      
      const qrOverlay = document.createElement('div');
      qrOverlay.className = 'modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4';
      qrOverlay.innerHTML = `
        <div class="modal-content rounded-2xl sm:rounded-3xl p-8 sm:p-16 max-w-2xl w-full max-h-[90%] overflow-auto">
          <div class="mb-6 sm:mb-8 text-center">
            <h3 class="text-3xl sm:text-5xl font-bold mb-4 sm:mb-6 holographic-text luxury-title">${t.scanQrCode}</h3>
            <p class="text-gray-300 mb-2 sm:mb-3 text-sm sm:text-lg">${t.qrInstruction}</p>
            <p class="text-white text-xl sm:text-2xl font-bold mb-6">æ€»é‡‘é¢: RM${totalAmount.toFixed(2)}</p>
          </div>
          
          <div class="mb-6 sm:mb-8">
            <!-- TNG QR Code -->
            ${selectedPaymentMethod === 'TNG' ? `
              <div class="text-center p-6 sm:p-8 feature-card rounded-2xl mb-6">
                <div class="mb-4 sm:mb-6">
                  <img src="https://i.ibb.co/YFtLt3z/IMG-1.jpg" 
                       alt="TNG QR Code" 
                       class="mx-auto rounded-xl" 
                       style="max-width: 280px; width: 100%; height: auto; border: 4px solid rgba(30, 58, 138, 0.5);"
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div style="display: none;" class="text-gray-400 text-sm p-8 border-2 border-dashed border-gray-600 rounded-xl">
                    <div class="text-5xl mb-4">ğŸ“±</div>
                    <p class="text-xl">TNG QR Code</p>
                    <p class="text-sm mt-2">è¯·ä½¿ç”¨Touch 'N Goæ‰«æäºŒç»´ç ä»˜æ¬¾</p>
                  </div>
                </div>
                <p class="text-white font-bold text-lg sm:text-xl mb-2">Touch 'N Go eWallet</p>
                <p class="text-gray-400 text-sm">${t.scanWithTng}</p>
              </div>
            ` : ''}
            
            <!-- Litecoin Address -->
            ${selectedPaymentMethod === 'Litecoin' ? `
              <div class="text-center p-6 sm:p-8 feature-card rounded-2xl mb-6">
                <div class="mb-4 sm:mb-6">
                  <img src="https://i.ibb.co/rRysdJ4/IMG-913.jpg" 
                       alt="LTC QR Code" 
                       class="mx-auto rounded-xl" 
                       style="max-width: 280px; width: 100%; height: auto; border: 4px solid rgba(138, 43, 226, 0.5);"
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div style="display: none;" class="text-gray-400 text-sm p-8 border-2 border-dashed border-purple-600 rounded-xl">
                    <div class="text-5xl mb-4">â‚¿</div>
                    <p class="text-xl">LTC QR Code</p>
                    <p class="text-sm mt-2">è¯·æ‰«æLTCäºŒç»´ç å®Œæˆä»˜æ¬¾</p>
                  </div>
                </div>
                <p class="text-xs sm:text-sm text-gray-400 mb-2 sm:mb-3">LTC Address:</p>
                <p class="text-white font-mono text-sm sm:text-lg break-all mb-3 sm:mb-4 bg-gray-800 p-3 rounded-lg">ltc1qq7ra3uhka9sf38tq4m5elp0mawn99ytxkk0xvw</p>
                <button class="copy-ltc-btn luxury-button px-6 py-2 sm:px-8 sm:py-3 rounded-xl font-bold text-xs sm:text-sm hover:scale-105 transition-all">
                  ${t.copyAddress}
                </button>
              </div>
            ` : ''}
            
            <!-- PayPal Instructions -->
            ${selectedPaymentMethod === 'PayPal' ? `
              <div class="text-center p-6 sm:p-8 feature-card rounded-2xl mb-6">
                <div class="mb-4 sm:mb-6">
                  <div class="text-5xl mb-4">ğŸ’³</div>
                  <p class="text-white text-lg sm:text-xl font-bold mb-2">${t.paypalInstruction}</p>
                  <p class="text-gray-400 text-sm mb-2">${t.paypalEmail}:</p>
                  <p class="text-white font-mono text-lg sm:text-xl font-bold mb-4 bg-gray-800 p-3 rounded-lg">${PAYPAL_EMAIL}</p>
                  <button class="copy-paypal-btn luxury-button px-6 py-2 sm:px-8 sm:py-3 rounded-xl font-bold text-xs sm:text-sm hover:scale-105 transition-all">
                    ${t.copyAddress}
                  </button>
                </div>
              </div>
            ` : ''}
          </div>
          
          <div class="text-center mb-6 sm:mb-8">
            <p class="text-gray-300 mb-2">${t.afterPayment}</p>
            <p class="text-gray-400 text-sm">${t.afterPaymentDesc}</p>
          </div>
          
          <div class="flex flex-col sm:flex-row gap-4 sm:gap-6">
            <button id="cancel-qr" class="flex-1 px-8 py-4 sm:py-5 rounded-xl font-bold text-base sm:text-lg glass-card text-white hover:scale-105 transition-all">
              ${t.closeBtn}
            </button>
            <button id="next-step" class="flex-1 px-8 py-4 sm:py-5 rounded-xl font-bold text-base sm:text-lg luxury-button hover:scale-105 transition-all">
              ${t.nextStep} â†’ ${t.uploadProof}
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(qrOverlay);
      
      // å…³é—­è´­ç‰©è½¦æ¨¡æ€æ¡†
      document.getElementById('cart-modal').classList.add('hidden');
      document.getElementById('cart-modal').classList.remove('flex');
      
      // æ·»åŠ å¤åˆ¶åœ°å€åŠŸèƒ½
      const copyLtcBtn = qrOverlay.querySelector('.copy-ltc-btn');
      if (copyLtcBtn) {
        copyLtcBtn.addEventListener('click', function() {
          navigator.clipboard.writeText('ltc1qq7ra3uhka9sf38tq4m5elp0mawn99ytxkk0xvw').then(() => {
            const originalText = copyLtcBtn.textContent;
            copyLtcBtn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
            setTimeout(() => {
              copyLtcBtn.textContent = originalText;
            }, 2000);
          });
        });
      }
      
      const copyPaypalBtn = qrOverlay.querySelector('.copy-paypal-btn');
      if (copyPaypalBtn) {
        copyPaypalBtn.addEventListener('click', function() {
          navigator.clipboard.writeText(PAYPAL_EMAIL).then(() => {
            const originalText = copyPaypalBtn.textContent;
            copyPaypalBtn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
            setTimeout(() => {
              copyPaypalBtn.textContent = originalText;
            }, 2000);
          });
        });
      }
      
      // äº‹ä»¶ç›‘å¬
      qrOverlay.querySelector('#cancel-qr').addEventListener('click', function() {
        document.body.removeChild(qrOverlay);
      });
      
      qrOverlay.querySelector('#next-step').addEventListener('click', function() {
        document.body.removeChild(qrOverlay);
        showUploadModal();
      });
      
      // ç‚¹å‡»èƒŒæ™¯å…³é—­
      qrOverlay.addEventListener('click', function(e) {
        if (e.target === qrOverlay) {
          document.body.removeChild(qrOverlay);
        }
      });
    }
       // æ˜¾ç¤ºä¸Šä¼ å›¾ç‰‡çš„æ¨¡æ€æ¡†
    function showUploadModal() {
      const t = translations[currentLang];
      
      const uploadOverlay = document.createElement('div');
      uploadOverlay.className = 'modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4';
      uploadOverlay.innerHTML = `
        <div class="modal-content rounded-2xl sm:rounded-3xl p-8 sm:p-16 max-w-2xl w-full max-h-[90%] overflow-auto">
          <div class="mb-6 sm:mb-8 text-center">
            <svg class="mx-auto mb-4 sm:mb-6" width="100" height="100" viewBox="0 0 120 120" fill="none" class="sm:w-[120px] sm:h-[120px]">
              <circle cx="60" cy="60" r="60" fill="url(#uploadGradient)"/>
              <path d="M30 60H90M60 30V90" stroke="white" stroke-width="6" stroke-linecap="round"/>
              <defs>
                <linearGradient id="uploadGradient" x1="0" y1="0" x2="120" y2="120">
                  <stop offset="0%" style="stop-color:#8a2be2"/>
                  <stop offset="100%" style="stop-color:#00bfff"/>
                </linearGradient>
              </defs>
            </svg>
            <h3 class="text-3xl sm:text-5xl font-bold mb-4 sm:mb-6 holographic-text luxury-title">${t.uploadPaymentProof}</h3>
            <p class="text-gray-300 mb-2 sm:mb-3 text-sm sm:text-lg">${t.paymentProofDesc}</p>
            <p class="text-gray-400 text-xs sm:text-sm mb-6">${t.supportedFormats}</p>
          </div>
          
          <div id="upload-container" class="mb-6 sm:mb-8">
            <div class="border-2 border-dashed border-purple-500 rounded-2xl p-8 sm:p-12 text-center cursor-pointer transition-all hover:bg-purple-900/20 hover:border-purple-600" 
                 id="drop-area"
                 style="min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
              
              <svg class="mx-auto mb-4 sm:mb-6" width="80" height="80" viewBox="0 0 100 100" fill="none" class="sm:w-[100px] sm:h-[100px]">
                <circle cx="50" cy="50" r="50" fill="rgba(138, 43, 226, 0.2)"/>
                <path d="M70 50L50 30L30 50M50 30V80" stroke="#8a2be2" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              
              <p class="text-white text-lg sm:text-xl font-semibold mb-2">${t.dropImageHere}</p>
              <p class="text-gray-400 text-sm sm:text-base mb-4">${t.supportedFormats}</p>
              
              <button id="browse-btn" class="luxury-button px-8 py-3 sm:px-10 sm:py-4 rounded-xl font-bold text-base sm:text-lg hover:scale-105 transition-all">
                ${t.browseFiles}
              </button>
              
              <input type="file" id="file-input" accept="image/*" class="hidden">
            </div>
            
            <div id="preview-container" class="mt-6 hidden">
              <p class="text-white font-bold mb-3 text-lg">${t.preview}:</p>
              <div class="relative">
                <img id="image-preview" class="rounded-xl mx-auto max-w-full max-h-[300px]" 
                     style="border: 3px solid rgba(138, 43, 226, 0.5);">
                <button id="remove-image" class="absolute top-2 right-2 w-10 h-10 rounded-full bg-red-500 flex items-center justify-center hover:bg-red-600 transition-all hover:scale-110">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M6 18L18 6M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <div class="flex flex-col sm:flex-row gap-4 sm:gap-6">
            <button id="back-to-qr" class="flex-1 px-8 py-4 sm:py-5 rounded-xl font-bold text-base sm:text-lg glass-card text-white hover:scale-105 transition-all">
              â† ${t.back}
            </button>
            <button id="submit-payment" class="flex-1 px-8 py-4 sm:py-5 rounded-xl font-bold text-base sm:text-lg luxury-button hover:scale-105 transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              ${t.submitPayment}
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(uploadOverlay);
      initUploadFunctionality(uploadOverlay);
    }

    function initUploadFunctionality(uploadOverlay) {
      const dropArea = uploadOverlay.querySelector('#drop-area');
      const fileInput = uploadOverlay.querySelector('#file-input');
      const browseBtn = uploadOverlay.querySelector('#browse-btn');
      const previewContainer = uploadOverlay.querySelector('#preview-container');
      const imagePreview = uploadOverlay.querySelector('#image-preview');
      const removeImageBtn = uploadOverlay.querySelector('#remove-image');
      const submitBtn = uploadOverlay.querySelector('#submit-payment');
      const backBtn = uploadOverlay.querySelector('#back-to-qr');
      const t = translations[currentLang];
      
      browseBtn.addEventListener('click', () => fileInput.click());
      fileInput.addEventListener('change', handleFileSelect);
      
      // æ‹–æ”¾åŠŸèƒ½
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
      });
      
      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }
      
      ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
      });
      
      ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
      });
      
      function highlight() {
        dropArea.classList.add('bg-purple-900/30', 'border-purple-600');
      }
      
      function unhighlight() {
        dropArea.classList.remove('bg-purple-900/30', 'border-purple-600');
      }
      
      dropArea.addEventListener('drop', handleDrop, false);
      
      function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
      }
      
      function handleFileSelect(e) {
        const files = e.target.files;
        handleFiles(files);
      }
      
      function handleFiles(files) {
        if (files.length === 0) return;
        
        const file = files[0];
        
        if (!file.type.match('image.*')) {
          alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
          return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
          alert(t.imageTooLarge);
          return;
        }
        
        uploadedPaymentProof = file;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.src = e.target.result;
          previewContainer.classList.remove('hidden');
          submitBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      }
      
      removeImageBtn.addEventListener('click', function() {
        uploadedPaymentProof = null;
        previewContainer.classList.add('hidden');
        submitBtn.disabled = true;
        fileInput.value = '';
      });
      
      submitBtn.addEventListener('click', async function() {
        if (!uploadedPaymentProof) {
          alert(t.paymentProofRequired);
          return;
        }
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = `<span class="relative z-10 flex items-center justify-center"><div class="loading-spinner mr-3"></div> ${t.uploading}</span>`;
        
        try {
          // å‘é€åˆ°Telegram
          await sendPaymentNotificationWithPhoto();
          
          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
          document.body.removeChild(uploadOverlay);
          showSuccessModal();
          
          // æ¸…ç©ºè´­ç‰©è½¦
          cart = [];
          selectedPaymentMethod = null;
          uploadedPaymentProof = null;
          updateCartCount();
          
        } catch (error) {
          console.error('æäº¤å¤±è´¥:', error);
          // å³ä½¿å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å¹¶æ¸…ç©ºè´­ç‰©è½¦
          document.body.removeChild(uploadOverlay);
          showSuccessModal();
          
          cart = [];
          selectedPaymentMethod = null;
          uploadedPaymentProof = null;
          updateCartCount();
        }
      });
      
      backBtn.addEventListener('click', function() {
        document.body.removeChild(uploadOverlay);
        showQRCodeModal();
      });
    }

    async function sendPaymentNotificationWithPhoto() {
      const deviceInfo = getUserDeviceInfo();
      const userIP = await getUserIP();
      let totalAmount = 0;
      
      const orderDetails = cart.map(item => {
        totalAmount += item.price * item.quantity;
        return `${item.product} Ã— ${item.quantity} = RM${item.price * item.quantity}`;
      }).join('\n');
      
      const caption = `ğŸ’° ä»˜æ¬¾å®Œæˆé€šçŸ¥\n\n`;
      caption += `ğŸ›’ è®¢å•è¯¦æƒ…:\n${orderDetails}\n`;
      caption += `ğŸ’° æ€»é‡‘é¢: RM${totalAmount}\n`;
      caption += `ğŸ’³ ä»˜æ¬¾æ–¹å¼: ${selectedPaymentMethod}\n`;
      caption += `â° ä»˜æ¬¾æ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n`;
      caption += `ğŸŒ IPåœ°å€: ${userIP}\n`;
      caption += `ğŸŒ åœ°åŒº: ${deviceInfo.language}\n`;
      caption += `ğŸ’» è®¾å¤‡: ${deviceInfo.platform}\n`;
      caption += `ğŸ“± å±å¹•: ${deviceInfo.screen}\n`;
      caption += `âœ… çŠ¶æ€: å·²ä»˜æ¬¾ï¼ˆå‡­è¯å·²ä¸Šä¼ ï¼‰\n`;
      caption += `ğŸ“Š æ¥æº: Nyaaastore`;
      
      // å‘é€æ–‡æœ¬æ¶ˆæ¯
      await sendToTelegram(caption);
      
      // å‘é€å›¾ç‰‡
      if (uploadedPaymentProof) {
        await sendPhotoToTelegram(uploadedPaymentProof, 'ä»˜æ¬¾å‡­è¯æˆªå›¾');
      }
      
      return true;
    }

    function showSuccessModal() {
      const t = translations[currentLang];
      
      const successOverlay = document.createElement('div');
      successOverlay.className = 'modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4';
      successOverlay.innerHTML = `
        <div class="modal-content rounded-2xl sm:rounded-3xl p-8 sm:p-16 max-w-lg text-center">
          <div class="mb-6 sm:mb-8">
            <svg class="mx-auto" width="100" height="100" viewBox="0 0 140 140" fill="none" class="sm:w-[140px] sm:h-[140px]">
              <circle cx="70" cy="70" r="70" fill="url(#successGradient)"/>
              <path d="M40 70L60 90L100 50" stroke="white" stroke-width="8" stroke-linecap="round"/>
              <defs>
                <linearGradient id="successGradient" x1="0" y1="0" x2="140" y2="140">
                  <stop offset="0%" style="stop-color:#8a2be2"/>
                  <stop offset="100%" style="stop-color:#00bfff"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h3 class="text-3xl sm:text-5xl font-bold mb-4 sm:mb-6 holographic-text luxury-title">${t.paymentComplete}</h3>
          <p class="text-gray-300 mb-2 sm:mb-3 text-sm sm:text-lg">${t.paymentCompleteDesc}</p>
          <p class="text-gray-400 text-xs sm:text-sm mb-6 sm:mb-10">${t.telegramNotified}</p>
          <button class="close-success luxury-button px-10 py-4 sm:px-14 sm:py-6 rounded-xl font-bold text-base sm:text-xl hover:scale-105 transition-all">
            ${t.closeBtn}
          </button>
        </div>
      `;
      
      document.body.appendChild(successOverlay);
      
      successOverlay.querySelector('.close-success').addEventListener('click', function() {
        document.body.removeChild(successOverlay);
      });
      
      successOverlay.addEventListener('click', function(e) {
        if (e.target === successOverlay) {
          document.body.removeChild(successOverlay);
        }
      });
    }

    function showWarningModal(message) {
      const t = translations[currentLang];
      
      const warningOverlay = document.createElement('div');
      warningOverlay.className = 'modal-overlay fixed inset-0 flex items-center justify-center z-50 p-4';
      warningOverlay.innerHTML = `
        <div class="modal-content rounded-2xl sm:rounded-3xl p-8 sm:p-16 max-w-lg text-center">
          <div class="mb-6 sm:mb-8">
            <svg class="mx-auto" width="100" height="100" viewBox="0 0 120 120" fill="none" class="sm:w-[120px] sm:h-[120px]">
              <circle cx="60" cy="60" r="60" fill="url(#warningGradient)"/>
              <path d="M60 35V70M60 85V92" stroke="white" stroke-width="6" stroke-linecap="round"/>
              <defs>
                <linearGradient id="warningGradient">
                  <stop offset="0%" style="stop-color:#FFA500"/>
                  <stop offset="100%" style="stop-color:#FF8C00"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
          <h3 class="text-2xl sm:text-4xl font-bold mb-4 sm:mb-6 neon-text luxury-title">${message}</h3>
          <button class="close-warning luxury-button px-8 py-3 sm:px-12 sm:py-5 rounded-xl font-bold text-base sm:text-xl hover:scale-105 transition-all">
            ${t.closeBtn}
          </button>
        </div>
      `;
      document.body.appendChild(warningOverlay);

      warningOverlay.querySelector('.close-warning').addEventListener('click', function() {
        document.body.removeChild(warningOverlay);
      });
    }
       // äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('lang-toggle').addEventListener('click', function() {
      switchLanguage(currentLang === 'zh' ? 'en' : 'zh');
    });

    document.getElementById('currency-toggle').addEventListener('click', function() {
      const currencies = ['MYR', 'TWD'];
      const currentIndex = currencies.indexOf(currentCurrency);
      const nextIndex = (currentIndex + 1) % currencies.length;
      currentCurrency = currencies[nextIndex];
      document.getElementById('currency-text').textContent = `ğŸ’° ${currentCurrency}`;
      updateAllPrices();
    });

    function updateAllPrices() {
      document.querySelectorAll('.delivery-option').forEach(option => {
        const productCard = option.closest('.product-card');
        const productName = productCard.querySelector('.product-name').textContent.trim();
        const deliveryType = option.dataset.type;
        const fullProductName = `${productName} (${deliveryType})`;
        
        const priceElement = option.querySelector('.delivery-price');
        if (priceMap[fullProductName]) {
          const price = priceMap[fullProductName][currentCurrency];
          const symbol = currentCurrency === 'MYR' ? 'RM' : 'NT$';
          priceElement.textContent = `${symbol}${price}`;
        }
      });
      
      if (!document.getElementById('cart-modal').classList.contains('hidden')) {
        renderCart();
      }
    }

    // äº§å“é€‰é¡¹ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.delivery-option').forEach(option => {
      option.addEventListener('click', async function() {
        const productCard = this.closest('.product-card');
        productCard.querySelectorAll('.delivery-option').forEach(opt => {
          opt.classList.remove('border-purple-500', 'border-red-500', 'border-pink-500', 'border-yellow-500', 'bg-purple-900/30', 'bg-red-900/30', 'bg-pink-900/30', 'bg-yellow-900/30');
          opt.classList.add('border-purple-500/50');
        });
        
        this.classList.remove('border-purple-500/50', 'border-red-500/50', 'border-pink-500/50', 'border-yellow-500/50');
        
        const productName = productCard.querySelector('.product-name').textContent.trim();
        if (productName.includes('NITRO BASIC')) {
          this.classList.add('border-purple-500', 'bg-purple-900/30');
        } else if (productName.includes('DISCORD NITRO')) {
          this.classList.add('border-pink-500', 'bg-pink-900/30');
        } else if (productName.includes('1000 ROBUX')) {
          this.classList.add('border-red-500', 'bg-red-900/30');
        } else {
          this.classList.add('border-purple-500', 'bg-purple-900/30');
        }
        
        const deliveryType = this.dataset.type;
        const price = parseFloat(this.dataset.price);
        
        const fullProductName = `${productName} (${deliveryType})`;
        const existingItem = cart.find(item => item.product === fullProductName);
        if (existingItem) {
          existingItem.quantity++;
        } else {
          cart.push({ 
            product: fullProductName, 
            price: price, 
            quantity: 1,
            selectedTime: new Date().toISOString()
          });
        }
        updateCartCount();
        showSuccessMessage();
        
        // å‘é€åˆ°Telegram
        const deviceInfo = getUserDeviceInfo();
        const userIP = await getUserIP();
        
        let telegramMessage = `ğŸ›’ æ–°è®¢å•é€šçŸ¥\n\n`;
        telegramMessage += `ğŸ“¦ å•†å“: ${fullProductName}\n`;
        telegramMessage += `ğŸ’° ä»·æ ¼: RM${price}\n`;
        telegramMessage += `ğŸ“¦ æ•°é‡: ${existingItem ? existingItem.quantity : 1}\n`;
        telegramMessage += `â° æ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n`;
        telegramMessage += `ğŸŒ IPåœ°å€: ${userIP}\n`;
        telegramMessage += `ğŸŒ åœ°åŒº: ${deviceInfo.language}\n`;
        telegramMessage += `ğŸ’» è®¾å¤‡: ${deviceInfo.platform}\n`;
        telegramMessage += `ğŸ“± å±å¹•: ${deviceInfo.screen}\n`;
        telegramMessage += `ğŸ“Š çŠ¶æ€: å¾…ä»˜æ¬¾`;
        
        await sendToTelegram(telegramMessage);
      });
    });

    // è´­ç‰©è½¦æŒ‰é’®äº‹ä»¶
    document.getElementById('cart-button').addEventListener('click', function() {
      const modal = document.getElementById('cart-modal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      renderCart();
    });

    document.getElementById('close-cart').addEventListener('click', function() {
      const modal = document.getElementById('cart-modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });

    document.getElementById('cart-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.add('hidden');
        this.classList.remove('flex');
      }
    });

    // åˆå§‹åŒ–è¯­è¨€
    switchLanguage('zh');
  </script>
